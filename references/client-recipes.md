# Client Recipes (Python, Node, curl, PowerShell)

Use this reference for runnable publish commands aligned to the latest backend contract.

Conventions:
- `BASE_URL` examples below use `http://localhost:3000` (replace with real host).
- `AUTH_TOKEN` is optional for publish APIs. When provided and valid, ownership is directly attached to the user.

## 1) Python CLI (`scripts/publish_game.py`)

Upload zip:

```bash
python3 scripts/publish_game.py upload-zip \
  --base-url http://localhost:3000 \
  --zip ./my_game.zip \
  --title "My Game" \
  --description "Generated by AI" \
  --platform desktop \
  --content-type game \
  --cover ./cover.png \
  --header "Authorization: Bearer $AUTH_TOKEN"
```

Publish from directory:

```bash
python3 scripts/publish_game.py publish-files \
  --base-url http://localhost:3000 \
  --dir ./my_game_project \
  --title "My Game" \
  --platform mobile \
  --content-type code \
  --header "Authorization: Bearer $AUTH_TOKEN"
```

Prefer UTF-8 text content when possible:

```bash
python3 scripts/publish_game.py publish-files \
  --base-url http://localhost:3000 \
  --dir ./my_game_project \
  --title "My Game" \
  --prefer-text
```

## 2) Node.js CLI (`scripts/publish_game_node.mjs`)

Upload zip:

```bash
node scripts/publish_game_node.mjs upload-zip \
  --base-url http://localhost:3000 \
  --zip ./my_game.zip \
  --title "My Game" \
  --platform desktop \
  --content-type game \
  --cover ./cover.webp \
  --header "Authorization: Bearer $AUTH_TOKEN"
```

Publish from directory:

```bash
node scripts/publish_game_node.mjs publish-files \
  --base-url http://localhost:3000 \
  --dir ./my_game_project \
  --title "My Game" \
  --platform mobile \
  --content-type code \
  --prefer-text
```

## 3) curl recipes

### 3.1 Upload zip with `/api/upload` (Linux/macOS/Git Bash)

```bash
curl -sS -X POST "http://localhost:3000/api/upload" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -F "title=My Game" \
  -F "description=Generated by AI" \
  -F "platform=desktop" \
  -F "contentType=game" \
  -F "file=@./my_game.zip;type=application/zip" \
  -F "cover=@./cover.png;type=image/png"
```

### 3.2 Upload zip with `/api/upload` (Windows PowerShell with `curl.exe`)

```powershell
curl.exe -sS -X POST "http://localhost:3000/api/upload" `
  -H "Authorization: Bearer $env:AUTH_TOKEN" `
  -F "title=My Game" `
  -F "description=Generated by AI" `
  -F "platform=desktop" `
  -F "contentType=game" `
  -F "file=@C:/path/to/my_game.zip;type=application/zip" `
  -F "cover=@C:/path/to/cover.jpg;type=image/jpeg"
```

### 3.3 Publish files with `/api/publish`

Create `publish_payload.json`:

```json
{
  "title": "My Game",
  "description": "optional",
  "platform": "desktop",
  "contentType": "game",
  "files": [
    {
      "path": "index.html",
      "content": "<html><body>Hello</body></html>"
    },
    {
      "path": "assets/logo.png",
      "contentBase64": "iVBORw0KGgo..."
    }
  ]
}
```

Send request:

```bash
curl -sS -X POST "http://localhost:3000/api/publish" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  --data-binary @publish_payload.json
```

## 4) PowerShell native recipes

### 4.1 Upload zip via `Invoke-RestMethod`

```powershell
$baseUrl = "http://localhost:3000"
$form = @{
  title = "My Game"
  description = "Generated by AI"
  platform = "desktop"
  contentType = "game"
  file = Get-Item "C:\path\to\my_game.zip"
  cover = Get-Item "C:\path\to\cover.png"
}
$headers = @{
  Authorization = "Bearer $env:AUTH_TOKEN"
}
Invoke-RestMethod -Method Post -Uri "$baseUrl/api/upload" -Form $form -Headers $headers
```

### 4.2 Publish files via payload JSON

```powershell
$baseUrl = "http://localhost:3000"
$payload = Get-Content .\publish_payload.json -Raw
$headers = @{
  Authorization = "Bearer $env:AUTH_TOKEN"
}
Invoke-RestMethod -Method Post -Uri "$baseUrl/api/publish" -ContentType "application/json" -Body $payload -Headers $headers
```

## 5) Useful follow-up calls

Get random games:

```bash
curl -sS "http://localhost:3000/api/games/random?count=6&platform=desktop&contentType=game"
```

Fetch detail (includes `claimTokenState` when `onceToken` provided):

```bash
curl -sS "http://localhost:3000/api/games/<id>?fingerprint=device-123&onceToken=<onceToken>"
```

Claim ownership:

```bash
curl -sS -X POST "http://localhost:3000/api/games/<id>/claim" \
  -H "Authorization: Bearer $AUTH_TOKEN" \
  -H "Content-Type: application/json" \
  --data '{"onceToken":"<onceToken>","action":"claim"}'
```
